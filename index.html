<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Registro de Pausas</title>
<style>
    .red {
        color: red;
    }
</style>
</head>
<body>
<h1>Registro de Pausas</h1>
<label for="nome">Nome do Funcionário:</label>
<input type="text" id="nome" name="nome"><br>

<label for="tipo">Selecione o tipo de pausa:</label>
<select name="tipo" id="tipo">
    <option value="Entrada">Entrada</option>
    <option value="Saída">Saída</option>
    <option value="Pausa">Pausa</option>
    <option value="Almoço">Almoço</option>
    <option value="Segunda Pausa">Segunda Pausa</option>
</select>
<button onclick="registrarPausa()">Registrar</button>
<button onclick="exportarRegistros()">Exportar para Excel</button>
<h2>Últimos Registros:</h2>
<ul id="registros">
</ul>

<!-- Firebase JavaScript SDK -->
<script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js"></script>

<script>
  // Your web app's Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyAIc50N2xCKI3cFKU-QyHfq8FbjHPm9Bxo",
  authDomain: "svfhoras.firebaseapp.com",
  projectId: "svfhoras",
  storageBucket: "svfhoras.appspot.com",
  messagingSenderId: "991583766282",
  appId: "1:991583766282:web:1d06d15541967bc3c61cf3"
};
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    var database = firebase.database();

    var registros = JSON.parse(localStorage.getItem('registros')) || [];

    function registrarPausa() {
        var nome = document.getElementById('nome').value;
        var tipo = document.getElementById('tipo').value;
        var horaRegistro = new Date();
        var cor = '';

        if (tipo === 'Pausa') {
            var ultimoRegistro = registros.length > 0 ? registros[registros.length - 1] : null;
            if (ultimoRegistro && horaRegistro - ultimoRegistro.hora > 15 * 60 * 1000) {
                cor = 'red';
            }
        } else if (tipo === 'Almoço') {
            var ultimoRegistro = registros.find(function(registro) {
                return registro.tipo === 'Pausa';
            });
            if (ultimoRegistro && horaRegistro - ultimoRegistro.hora > 60 * 60 * 1000) {
                cor = 'red';
            }
        }

        registros.push({ nome: nome, tipo: tipo, hora: horaRegistro });

        var listaRegistros = document.getElementById('registros');
        var novoRegistro = document.createElement('li');
        novoRegistro.textContent = nome + ' - ' + tipo + ' - ' + horaRegistro.toLocaleString();
        novoRegistro.style.color = cor;
        listaRegistros.appendChild(novoRegistro);

        // Save records to local storage
        localStorage.setItem('registros', JSON.stringify(registros));

        // Add record to Firebase Realtime Database
        var recordRef = database.ref('records').push();
        recordRef.set({
            nome: nome,
            tipo: tipo,
            hora: horaRegistro.getTime() // Store timestamp for sorting
        });
    }

    function exportarRegistros() {
        // Convert records to JSON string and download as a file
        var jsonData = JSON.stringify(registros, null, 2);
        var blob = new Blob([jsonData], { type: 'application/json' });
        var url = URL.createObjectURL(blob);
        var a = document.createElement('a');
        a.href = url;
        a.download = 'registros.json';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
    }
</script>
</body>
</html>
